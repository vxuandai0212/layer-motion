<template>
  <div class="__title_sequence__">
    <div class="button-wrapper">
      <button class="btn_replay invisible">Replay</button>
    </div>
    <div class="wrapper">
      <svg
        class="nttd"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink"
        viewBox="0 0 347 500"
      >
        <mask id="mask_o1_1">
          <rect x="0" y="0" width="32" height="82" fill="white" />
        </mask>
        <mask id="mask_o1_2">
          <rect x="0" y="0" width="32" height="82" fill="white" />
        </mask>
        <mask id="mask_o2_1">
          <rect
            id="mask_o2_2_ani"
            x="-33"
            y="0"
            width="32"
            height="82"
            fill="white"
          />
        </mask>
        <mask id="mask_o2_2">
          <rect x="0" y="0" width="32" height="82" fill="white" />
        </mask>

        <g id="n1" transform="translate(13,65)">
          <g transform="translate(0,81)">
            <rect id="n1_1_2" width="24.5" height="162" />
          </g>
          <g transform="translate(0,22)">
            <path id="n1_1" d="M0,0 l24.5,49 0,10 -24.5,0z" />
          </g>

          <g transform="translate(0,0)">
            <path id="n1_2" d="M0,0 l33,0 36,76 0,5 -32,0 -37,-76z" />
          </g>
          <g transform="translate(124.5,266)">
            <path id="n1_2_2" d="M0,0 l33,0 36,76 0,5 -32,0 -37,-76z" />
          </g>
          <g transform="translate(123,266) skewX(25)">
            <rect id="n1_2_3" width="35" height="50" />
          </g>

          <g transform="translate(45,0)">
            <path id="n1_3" d="M0,0 l24,0 0,58 -24,-48 z" />
          </g>
          <g transform="translate(45,-65)">
            <rect id="n1_3_2" width="24" height="5" />
          </g>
        </g>
        <g id="o1" transform="translate(87,65)">
          <g mask="url(#mask_o1_1)" transform="translate(0,0)">
            <path id="o1_1" d="M32,0 c-43,0 -43,82 0,82" />
          </g>
          <g mask="url(#mask_o1_2)" transform="translate(38,0)">
            <path id="o1_2" d="M0,0 c43,0 43,82 0,82" />
          </g>
        </g>

        <g id="t1" transform="translate(13,153)">
          <g transform="translate(20.5,0)">
            <rect id="t1_1" width="29" height="81" />
          </g>
          <g transform="translate(0,0)">
            <path id="t1_2" d="M0,0 l18,0 -18,38z" />
          </g>
          <g transform="translate(51,0)">
            <path id="t1_3" d="M0,0 l18,0 0,38z" />
          </g>
        </g>
        <g id="i1" transform="translate(89.5,153)">
          <rect id="i1_1" width="29" height="81" />
        </g>
        <g id="m1" transform="translate(123,153)">
          <g transform="translate(0,30)">
            <path id="m1_1" d="M14,0 l11.8,46 -2,5 -23,0z" />
          </g>
          <g transform="translate(17,0)">
            <path id="m1_2" d="M4,0 l19,0 21,81 -26.5,0 -17,-65z" />
          </g>
          <g transform="translate(51,0)">
            <path id="m1_3" d="M4,0 l19,0 21,81 -26.5,0 -17,-65z" />
          </g>
        </g>
        <g id="e1" transform="translate(223,153)">
          <g transform="translate(0,0)">
            <rect id="e1_1" width="28.2" height="81" />
            >
          </g>
          <g transform="translate(31,0)">
            <path id="e1_2" d="M0,0 l27.5,0 0,30z" />
          </g>
          <g transform="translate(31,23.5)">
            <path id="e1_3" d="M0,15 l17,-16 0,32z" />
          </g>
          <g transform="translate(31,45)">
            <path id="e1_4" d="M28,0 l0,36 -28,0z" />
          </g>
        </g>

        <g id="t2" transform="translate(89.5,240)">
          <g transform="translate(20.5,0)">
            <rect id="t2_1" width="29" height="81" />
          </g>
          <g transform="translate(0,0)">
            <path id="t2_2" d="M0,0 l18,0 -18,38z" />
          </g>
          <g transform="translate(51,0)">
            <path id="t2_3" d="M0,0 l18,0 0,38z" />
          </g>
        </g>
        <g id="o2" transform="translate(164,240)">
          <g mask="url(#mask_o2_1)" transform="translate(0,0)">
            <path id="o2_1" d="M32,0 c-43,0 -43,82 0,82" />
          </g>
          <g mask="url(#mask_o2_2)" transform="translate(38,0)">
            <path id="o2_2" d="M0,0 c43,0 43,82 0,82" />
          </g>
        </g>

        <g id="d1" transform="translate(166,328)">
          <g transform="translate(0,0)">
            <rect id="d1_1" width="29" height="82" />
          </g>
          <g mask="url(#mask_o2_2)" transform="translate(36,0)">
            <path id="d1_2" d="M0,0 c43,0 43,82 0,82" />
          </g>
        </g>
        <g id="i2" transform="translate(238.5,328)">
          <rect id="i2_1" width="29" height="81" />
        </g>
        <g id="e2" transform="translate(274,328)">
          <g transform="translate(0,0)">
            <rect id="e2_1" width="28.2" height="81" />
          </g>
          <g transform="translate(31,0)">
            <path id="e2_2" d="M0,0 l27.5,0 0,30z" />
          </g>
          <g transform="translate(31,23.5)">
            <path id="e2_3" d="M0,15 l17,-16 0,32z" />
          </g>
          <g transform="translate(31,45)">
            <path id="e2_4" d="M28,0 l0,36 -28,0z" />
          </g>
        </g>

        <g transform="translate(-1,-21)" id="waltherPPK_007">
          <path
            d="M251.3,302.8c-0.8-0.4-1.5-1.1-1.9-2.1c-0.3-0.7-0.4-1.1-0.4-2.6c-0.1-2.2,0.2-3.5,1.4-5.9c0.7-1.4,1-1.8,1.9-2.8 c1.5-1.5,2.4-1.9,4.1-2c1.1-0.1,1.3,0,1.8,0.2c0.6,0.3,1.3,1,1.7,1.6c0.9,1.5,1,4.2,0.4,6.5c-1.1,3.5-3.2,6.2-5.5,7 C253.8,303.1,252,303.1,251.3,302.8z M253.4,300.5c2.6-2.8,4.9-9.9,3.8-11.3c-0.3-0.3-0.6-0.2-1.4,0.6c-1.9,2-4.7,9.8-4,11.1 C252.1,301.5,252.6,301.4,253.4,300.5z"
          />
          <path
            d="M263.2,302.6c-1.5-0.8-2.3-2.4-2.2-5c0-4,2.4-8.3,5.4-9.7c1.2-0.6,3.1-0.7,3.9-0.2c3.3,1.7,3.2,8.1-0.2,12.6 c-0.7,1-1.7,1.8-2.8,2.4c-0.5,0.2-1,0.4-2,0.4C264.1,303.1,263.9,303,263.2,302.6z M265.1,300.9c1.9-1.6,4.4-7.3,4.4-10.3 c0-2.8-1.6-1.8-3.4,2.1c-1.6,3.3-2.7,7.7-2.2,8.3C264.2,301.4,264.6,301.3,265.1,300.9z"
          />
          <path
            d="M272.7,302.3c0.2-0.7,1-2.5,1.5-3.4c0.3-0.5,1.7-2.3,3.2-4.1c2.3-2.8,3.6-4.6,3.6-5c0-0.1-1.1-0.1-2.4-0.1h-2.4l-0.5,1.1 l-0.5,1.1l-1.1,0c-0.9,0-1.1,0-1.1-0.2c0-0.4,0.6-2.2,1.1-3.3l0.5-1.1h5.3h5.3v0.5c0,0.8-0.4,2.3-0.9,3.4c-0.5,1.1-1.4,2.4-4,5.6 c-1.5,1.8-2.7,3.9-3.2,5.3l-0.2,0.5h-2.1h-2.1L272.7,302.3z"
          />
          <path
            d="M278.1,302.6c0-0.1,0.1-0.3,0.2-0.5c0.1-0.2,0.1-0.3,0-0.4c-0.4-0.1,0.1-0.3,0.7-0.3c0.6,0,0.7,0,0.6,0.3 c-0.1,0.2-0.1,0.2,0.1,0c0.1-0.1,0.3-0.3,0.5-0.3c0.2,0,0.2,0.1,0.1,0.3c-0.1,0.1-0.2,0.4-0.2,0.7c-0.1,0.4-0.2,0.4-0.8,0.4 c-0.7,0-0.7,0-0.4-0.8c0.2-0.4-0.1-0.1-0.3,0.3C278.4,302.7,278.1,302.9,278.1,302.6z"
          />
          <path
            d="M281.3,296.5c0-0.1,0.1-0.3,0.3-0.5l0.3-0.4h2.2h2.2l0.4-0.4c0.2-0.2,0.7-0.9,1-1.5l0.5-1.1h-1.2c-1.2,0-1.2,0-1.3,0.4 c-0.1,0.2-0.1,0.6-0.1,0.9c0.1,0.7-0.2,0.7-0.7,0.1c-0.6-0.7-0.7-1.5-0.2-2.7l0.1-0.4h3.9c2.2,0,3.9,0.1,3.9,0.1 c0,0.3-0.9,0.9-1.7,1c-0.5,0.1-0.9,0.3-1,0.5c-0.1,0.2-0.7,1-1.2,1.9c-0.6,1-1.2,1.6-1.4,1.8c-0.3,0.1-1.2,0.2-3.2,0.3 C282.6,296.6,281.3,296.6,281.3,296.5z"
          />
          <path
            d="M285.2,290.6c0,0,0.1-0.4,0.3-0.7c0.2-0.4,0.3-1.1,0.4-1.5l0.1-0.9h6.5h6.6v0.6c0,0.4-0.1,0.7-0.5,1.2l-0.5,0.6l-2.2,0.1 c-2.1,0.1-2.2,0.1-2.5,0.4c-0.3,0.3-0.3,0.3-4.2,0.3C287,290.6,285.2,290.6,285.2,290.6z"
          />
        </g>
      </svg>
    </div>
  </div>
</template>
<script>
import gsap from 'gsap'
import Power3 from 'gsap'
export default {
  name: 'TitleSequence',
  mounted() {
    const pow3InOut = Power3.inOut

    let time_row1, time_row2, time_row3, time_row4

    let replayBtn = document.querySelector('.btn_replay')
    replayBtn.addEventListener('click', () => {
      run()
      toggleReplay()
    })

    function preset() {
      // For masking, initial opacity (0), must be set by JS
      // If it is set by CSS the JS cannot override.
      // I know - feels wrong, but there we are
      gsap.set(
        [
          '#n1_1',
          '#n1_1_2',
          '#n1_2',
          '#n1_2_2',
          '#n1_2_3',
          '#n1_3',
          '#n1_3_2',
          '#o1_1',
          '#o1_2',
          '#t1_1',
          '#t1_2',
          '#t1_3',
          '#i1_1',
          '#m1_1',
          '#m1_2',
          '#m1_3',
          '#e1_1',
          '#e1_2',
          '#e1_3',
          '#e1_4',
          '#t2_1',
          '#t2_2',
          '#t2_3',
          '#o2_1',
          '#o2_2',
          '#d1_1',
          '#d1_2',
          '#i2_1',
          '#e2_1',
          '#e2_2',
          '#e2_3',
          '#e2_4',
          '#waltherPPK_007'
        ],
        { opacity: 0 }
      )
    }

    function runSequence() {
      /*	Kick off times for each row.
		To delay the start, just change 'time_row1' */
      time_row1 = 0.5
      time_row2 = time_row1 + 0.95
      time_row3 = time_row1 + 0.8
      time_row4 = time_row1 + 0.95
      //
      /* ROW 1 :: NO */
      gsap.set('#n1_2', { x: 124.5, y: 266 })
      gsap.set('#n1_2_2', { x: 0, y: 0 })
      gsap.to(['#n1_2', '#n1_2_2', '#n1_2_3'], {
        duration: 0.25,
        delay: time_row1,
        opacity: 1
      })
      gsap.to('#n1_2', {
        duration: 0.4,
        delay: time_row1,
        x: 0,
        y: 0,
        ease: pow3InOut
      })

      gsap.set('#n1_2_3', { x: 0, y: 0, scaleY: 1 })
      gsap.to('#n1_2_3', {
        duration: 0.3,
        delay: time_row1,
        y: -200,
        scaleY: 4,
        ease: pow3InOut
      })
      gsap.to('#n1_2_3', {
        duration: 0.2,
        delay: time_row1 + 0.3,
        scaleY: 0.2,
        ease: pow3InOut
      })
      gsap.to('#n1_2_2', {
        duration: 0.4,
        delay: time_row1 + 0.2,
        x: -124.5,
        y: -266,
        ease: pow3InOut
      })

      gsap.set('#n1_1', { y: 110 })
      gsap.set('#n1_1_2', { y: 109 })
      gsap.to(['#n1_1', '#n1_1_2'], {
        duration: 0.25,
        delay: (time_row1 += 0.2),
        opacity: 1
      })
      gsap.to('#n1_1', {
        duration: 0.8,
        delay: time_row1,
        y: 0,
        ease: pow3InOut
      })
      gsap.to('#n1_1_2', {
        duration: 0.8,
        delay: time_row1,
        y: 0,
        scaleY: 0,
        ease: pow3InOut
      })

      gsap.set('#n1_3', { y: -65 })
      gsap.set('#n1_3_2', { y: 0 })
      gsap.to(['#n1_3', '#n1_3_2'], {
        duration: 0.25,
        delay: time_row1,
        opacity: 1
      })
      gsap.to('#n1_3', {
        duration: 0.8,
        delay: time_row1,
        y: 0,
        ease: pow3InOut
      })

      gsap.to('#n1_3_2', {
        duration: 0.8,
        delay: time_row1,
        scaleY: 15,
        ease: pow3InOut
      })
      gsap.to('#n1_3_2', {
        duration: 0.8,
        delay: (time_row1 += 0.2),
        scaleY: 1,
        y: 70,
        ease: pow3InOut
      })

      gsap.set('#o1_1', { delay: time_row1, opacity: 1, x: 33 })
      gsap.to('#o1_1', { duration: 0.5, delay: time_row1, x: 0 })
      gsap.set('#o1_2', { delay: time_row1, opacity: 1, x: -33 })
      gsap.to('#o1_2', { duration: 0.5, delay: (time_row1 += 0.15), x: 0 })

      /* ROW 2 :: TIME */
      gsap.set('#t1_1', { delay: time_row2, opacity: 1, scaleY: 0 })
      gsap.to('#t1_1', { duration: 0.25, delay: time_row2, opacity: 1 })
      gsap.to('#t1_1', { duration: 0.5, delay: time_row2, scaleY: 1 })
      gsap.set('#t1_2', { delay: time_row2, opacity: 0, scale: 0 })
      gsap.to('#t1_2', {
        duration: 0.25,
        delay: (time_row2 += 0.1),
        opacity: 1
      })
      gsap.to('#t1_2', { duration: 0.5, delay: time_row2, scale: 1 })
      gsap.set('#t1_3', { opacity: 0, scale: 0, transformOrigin: '100% 0' })
      gsap.to('#t1_3', { duration: 0.25, delay: time_row2 + 0.2, opacity: 1 })
      gsap.to('#t1_3', { duration: 0.5, delay: time_row2, scale: 1 })

      gsap.set('#i1_1', { delay: (time_row2 += 0.4), opacity: 1, scaleY: 0 })
      gsap.to('#i1_1', { duration: 0.25, delay: time_row2, opacity: 1 })
      gsap.to('#i1_1', { duration: 0.5, delay: time_row2, scaleY: 1 })

      gsap.set('#m1_1', {
        delay: (time_row2 += 0.2),
        opacity: 1,
        scale: 0,
        transformOrigin: '0 100%'
      })
      gsap.to('#m1_1', { duration: 0.5, delay: time_row2, scale: 1 })

      gsap.set('#m1_2', {
        delay: time_row2,
        opacity: 1,
        scale: 0,
        transformOrigin: '100% 100%'
      })
      gsap.to('#m1_2', { duration: 0.5, delay: time_row2, scale: 1 })
      gsap.set('#m1_3', {
        delay: time_row2,
        opacity: 1,
        scale: 0,
        transformOrigin: '0 0'
      })
      gsap.to('#m1_3', { duration: 0.5, delay: (time_row2 += 0.3), scale: 1 })

      gsap.set('#e1_1', {
        delay: (time_row2 += 0.4),
        opacity: 1,
        scaleY: 2,
        transformOrigin: '50% 100%',
        y: 430
      })
      gsap.to('#e1_1', { duration: 1, delay: time_row2, y: 0 })
      gsap.to('#e1_1', { duration: 0.5, delay: time_row2 + 0.5, scaleY: 1 })

      gsap.set('#e1_2', {
        delay: time_row2,
        opacity: 1,
        scale: 0,
        transformOrigin: '0 -50%',
        rotation: -90
      })
      gsap.set('#e1_4', {
        delay: time_row2,
        opacity: 1,
        scale: 0,
        transformOrigin: '0 100%',
        rotation: 90
      })
      gsap.set('#e1_3', { delay: time_row2, opacity: 1, scale: 0, x: 93 })
      gsap.to(['#e1_2', '#e1_4'], {
        duration: 0.5,
        delay: time_row2 + 0.5,
        scale: 1,
        rotation: 0
      })
      gsap.to('#e1_3', {
        duration: 0.5,
        delay: time_row2 + 0.5,
        scale: 1,
        x: 0
      })

      /* ROW 3 :: TO */
      gsap.set('#t2_1', { scaleY: 2, y: 150 })
      gsap.set('#t2_3', { opacity: 1, scale: 0 })
      gsap.to('#t2_3', {
        duration: 0.8,
        delay: time_row3,
        scale: 1,
        ease: pow3InOut
      })
      gsap.to('#t2_1', { duration: 0.25, delay: time_row3 + 0.1, opacity: 1 })
      gsap.to('#t2_1', {
        duration: 0.8,
        delay: time_row3 + 0.1,
        scaleY: 1,
        y: 0,
        ease: pow3InOut
      })
      gsap.set('#t2_2', { opacity: 1, scale: 0, transformOrigin: '100% 0' })
      gsap.to('#t2_2', {
        duration: 0.4,
        delay: time_row3 + 0.6,
        scale: 1,
        ease: pow3InOut
      })

      gsap.set('#o2_1', { delay: time_row3 + 0.4, opacity: 1 })
      gsap.to('#mask_o2_2_ani', {
        duration: 0.5,
        delay: time_row3 + 1.15,
        x: 33
      })
      gsap.set('#o2_2', { opacity: 1, x: -33 })
      gsap.to('#o2_2', { duration: 0.5, delay: (time_row3 += 2.1), x: 0 })

      /* ROW 4 :: DIE */
      gsap.set('#d1_1', { delay: time_row4, opacity: 1, scaleY: 3, y: 260 })
      gsap.to('#d1_1', { duration: 0.75, delay: time_row4, y: 0 })
      gsap.to('#d1_1', { duration: 0.5, delay: (time_row4 += 0.5), scaleY: 1 })

      gsap.set('#d1_2', { delay: (time_row4 += 1.1), opacity: 1, x: -33 })
      gsap.to('#d1_2', { duration: 0.75, delay: time_row4, x: 0 })

      gsap.set('#i2_1', {
        delay: (time_row4 += 0.4),
        opacity: 1,
        scaleY: 3,
        y: 260
      })
      gsap.to('#i2_1', { duration: 0.75, delay: time_row4, y: 0 })
      gsap.to('#i2_1', { duration: 0.5, delay: (time_row4 += 0.5), scaleY: 1 })

      gsap.set('#e2_1', {
        delay: time_row4,
        opacity: 1,
        scaleY: 0,
        transformOrigin: '50% 0'
      })
      gsap.to('#e2_1', { duration: 0.5, delay: time_row4, scale: 1 })

      gsap.set('#e2_2', {
        opacity: 1,
        scale: 0,
        transformOrigin: '0 -50%',
        rotation: -90
      })
      gsap.set('#e2_4', {
        opacity: 1,
        scale: 0,
        transformOrigin: '0 100%',
        rotation: 90
      })
      gsap.set('#e2_3', { opacity: 1, scale: 0, x: 45 })
      gsap.to(['#e2_2', '#e2_4'], {
        duration: 0.5,
        delay: (time_row4 += 0.5),
        scale: 1,
        rotation: 0
      })
      gsap.to('#e2_3', { duration: 0.5, delay: time_row4, scale: 1, x: 0 })

      // Logo
      gsap.set('#waltherPPK_007', { scale: 1.6 })
      gsap.to('#waltherPPK_007', {
        duration: 0.5,
        delay: (time_row4 += 0.5),
        opacity: 1,
        onComplete: toggleReplay
      })
    }

    function toggleReplay() {
      replayBtn.classList.toggle('invisible')
    }

    function run() {
      preset()
      runSequence()
    }

    run()
  }
}
</script>
<style lang="scss" scoped>
$gunmetal: #8e8067;
* {
  margin: 0;
}
.__title_sequence__ {
  background: black;
  color: white;
  font-family: sans-serif;
  width: 100vw;
  height: 100vh;
}
.wrapper {
  height: auto;
  position: relative;
  width: 100%;
  max-width: 50vh;
}
svg {
  position: absolute;
  &.nttd {
    fill: white;
    height: inherit;
    width: inherit;
    #waltherPPK_007 {
      fill: $gunmetal;
    }
  }
}
a {
  color: white;
  margin: 10px;
  z-index: 1;
}
.button-wrapper {
  height: 25px;
}
.invisible {
  display: none;
}
</style>
